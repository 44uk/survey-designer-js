<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>SurveyDesinger Preview</title>
    <style>
      .m3-enquete__user-agent-group--SP #surveyBox,
      .m3-enquete__user-agent-group--APP #surveyBox,
      .m3-enquete__user-agent-group--SP .questionsEditBox,
      .m3-enquete__user-agent-group--APP .questionsEditBox {
        width: 320px;
      }
    </style>
  </head>
  <body class="m3-enquete__user-agent-group--PC">
    <div id="root">
    </div>
    <script src="js/preview.bundle.js"></script>
    <script>
window.addEventListener('message', function(e) {
  if (e.origin !== location.origin) {
    alert('オリジンが一致しません');
    return;
  }
  if (e.data.type !== 'surveyResponse') return;
  var survey = JSON.parse(e.data.value);
  var el = document.getElementById('root');

  var params = {};
  location.search.substr(1).split(/&/).forEach(function(token) {
    var keyValue = token.split(/=/);
    if (keyValue.length !== 2) return;
    var ret = {};
    params[decodeURIComponent(keyValue[0])] = decodeURIComponent(keyValue[1]);
  });

  SurveyDesigner.Preview(el, {
    survey: survey,
    options: {
      css: params.css || 'js/default.css',
      pageLoadedFn: function(survey, runtime) {
        var nodeId = runtime.getCurrentNodeId();
      },
    },
  });
}, false);
window.opener.postMessage({ type: 'surveyRequest' }, '*');
    </script>
  </body>
</html>
